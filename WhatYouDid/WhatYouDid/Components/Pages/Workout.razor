@page "/workout/{RoutineId:int}"

@using WhatYouDid.Routines
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Identity
@using System.Text
@using System.Security.Claims
@attribute [Authorize]
@rendermode RenderMode.InteractiveServer
@inject IRoutineService RoutineService
@inject UserManager<ApplicationUser> UserManager
@inject NavigationManager Navigation
@inject AuthenticationStateProvider Authentication

<RadzenText TextStyle="TextStyle.H4">Workout: @RoutineId</RadzenText>

@code {

	[Parameter]
	public int RoutineId { get; set; }

	[CascadingParameter]
	private Task<AuthenticationState>? authenticationState { get; set; }


	public string? RoutineName { get; set;  }
	public Routine? Routine { get; set; }

	protected override async Task OnInitializedAsync()
	{
		if (authenticationState is null)
			return;

		// Get the user:
		var authState = await Authentication.GetAuthenticationStateAsync();
		var userId = authState.User.FindFirstValue(ClaimTypes.NameIdentifier);
		var user = await UserManager.FindByIdAsync(userId);

		Routine = await RoutineService.GetRoutineAsync(RoutineId);
	}


}
